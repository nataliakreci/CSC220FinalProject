<!-- dropwdown menu taken from https://www.w3schools.com/howto/howto_js_dropdown.asp. To be changed and improved in the future-->

{% extends "base.html" %}

{% block content %}

    {% if images %}
    <p> Welcome to play mode! Here, your time will be recorded when you start typing. </p>
    <p> Click "Next" or your enter button to proceed to the next word. </p>
    <p> Choose the level of difficulty you would like for the words:
    <!--<form>
    <br>
    <select name="Level of word difficulty?" size = "4" id="opts" onchange="showForm()">
  		<option value="0">Easy</option>
  		<option value="1">Medium</option>
  		<option value="2">Hard</option>
  		<option value="3">All</option>
	</select>
	</form>
	<span class="dropdown">
		<button onclick="myFunction()" class="dropbtn">Level</button>
  		<span id="myDropdown" class="dropdown-content">
    		<a>All</a>
    		<a>Easy</a>
    		<a>Medium</a>
    		<a>hard</a>
  		</span>
  	</span>-->
  	<form >
		<input type="radio" name="choice" value="1" id="easy"> Easy
		<input type="radio" name="choice" value="2" id="medium"> Medium
		<input type="radio" name="choice" value="3" id="hard"> Hard
		<input type="radio" name="choice" value="0" id="all"> All
	</form>
	<button class="level">Change level</button>
    <p><b> Good Luck! <b></p>

    <div class="full-img">
      <img class="displayed-img">
    </div>
    Your answer:<br>
  	<input class="input" id="input" type="text" name=input value="">
  	<br>
	<button class="enter">Next</button>
	<button class="skip" id="skip" >Skip</button>
	


    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    
    <script type="text/javascript">
    			/* When the user clicks on the button, toggle between hiding and showing the dropdown content */
		function myFunction() {
    		document.getElementById("myDropdown").classList.toggle("show");
		}
    
    	// Close the dropdown menu if the user clicks outside of it
		window.onclick = function(event) {
  			if (!event.target.matches('.dropbtn')) {
  				var dropdowns = document.getElementsByClassName("dropdown-content");
    			var i;
    			for (i = 0; i < dropdowns.length; i++) {
      				var openDropdown = dropdowns[i];
      				if (openDropdown.classList.contains('show')) {
        			openDropdown.classList.remove('show');
      				}
    			}
  			}
		}
    	/*function level() {
        	var selopt = document.getElementById("opts").value;
        	if (selopt == 0) {
        		var images = {{ images|tojson }};
        	}
        	if (selopt == 1) {
        		var images = {{ images|tojson }};
        	}
        	if (selopt == 2) {
        		var images = {{ images|tojson }};
        	}	
        	if (selopt == 3) {
        		var images = {{ images|tojson }};
        	}*/
    	var images = {{ images|tojson }};
    	initialize()
    	function initialize() {
    		document.getElementById("{{ level }}").checked = true;
			var displayedImage = document.querySelector('.displayed-img');
			var index = Math.floor(Math.random() * images.length);
			var img = images[index]
			displayedImage.setAttribute('src', 'static/'+img.image);
			displayedImage.setAttribute('width', '200');
			displayedImage.setAttribute('height', '200');
			displayedImage.setAttribute('id', img.word);
	
			btn = document.querySelector('.enter');
			btn2 = document.querySelector('.skip');
			btn_level = document.querySelector('.level');
			document.getElementById("skip").style.visibility="hidden";
			attempts = 0; // counter for the skip button
			
			var bool = true; // counter to start the timer
			var timeStart; // start time
			var timeEnd; // end time
			
			$SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
			
			document.getElementById("input").addEventListener("keypress", function() {
				if (bool==true){
					var d = new Date();
					timeStart = d.getTime(); // timer get started
					bool = false;
				}
     		}, false);
     		
     		
     		
			btn_level.onclick= function() { // function to change levels
				var level = document.forms[0];
   				var level_asked = "";
    			var i;
    			for (i = 0; i < level.length; i++) {
        			if (level[i].checked) {
            			level_asked = level[i].value;
        			}
    			}
				if (level_asked==1) {
					window.location.href = "/play_easy";
				}
				else if (level_asked==2) {
					window.location.href = "/play_medium";
				}
				else if (level_asked==3) {
					window.location.href = "/play_hard";
				}
				else {
					window.location.href = "/play";
				}
			}
			
			btn.onclick= function() { // function to check if the input is correct, after clicking the button
				var input = document.querySelector('.input');
				if (input.value==displayedImage.id){
					var d= new Date();
					timeEnd = d.getTime(); // timer stopped
						alert("Correct. Your time was " + ((timeEnd-timeStart)/1000) + "seconds!");
						var timing= (timeEnd-timeStart);
						$.getJSON($SCRIPT_ROOT + '/_add_image_known', { // calling the python function which will add the data to the db
        					input: img.word,
        					time: timing,
      					}, function(data) {
        					$("#result").text(data.result);
        					var level = document.forms[0];
   							var level_asked = "";
    						var i;
    						for (i = 0; i < level.length; i++) {
        						if (level[i].checked) {
            						level_asked = level[i].value;
        						}
    						}
							if (level_asked==1) {
								window.location.href = "/play_easy";
							}
							else if (level_asked==2) {
								window.location.href = "/play_medium";
							}
							else if (level_asked==3) {
								window.location.href = "/play_hard";
							}
							else {
								window.location.href = "/play";
							}
      					});
				}
				else{
					attempts += 1;
					skip(attempts); // check if the skip button should appear
					alert("Incorrect. Please try again");
					bool = true; // to restart the timer
					
					$.getJSON($SCRIPT_ROOT + '/_add_image_tried', { // calling the python function which will add the data to the db
        					input: img.word,
      					}, function(data) {
        					$("#result").text(data.result);
        				input.value= '';
      				});
				}
			}
			$(document).keypress(function (e) { // function to check if the input is correct, after pressing enter
                if (e.which == 13 || event.keyCode == 13) {
                    var input = document.querySelector('.input');
					if (input.value==displayedImage.id){
						var d= new Date();
						timeEnd = d.getTime();
						alert("Correct. Your time was " + ((timeEnd-timeStart)/1000) + "seconds!");
						var timing= (timeEnd-timeStart)
						$.getJSON($SCRIPT_ROOT + '/_add_image_known', { // calling the python function which will add the data to the db
        					input: img.word,
        					time: timing,
      					}, function(data) {
        					$("#result").text(data.result);
        					var level = document.forms[0];
   							var level_asked = "";
    						var i;
    						for (i = 0; i < level.length; i++) {
        						if (level[i].checked) {
            						level_asked = level[i].value;
        						}
    						}
							if (level_asked==1) {
								window.location.href = "/play_easy";
							}
							else if (level_asked==2) {
								window.location.href = "/play_medium";
							}
							else if (level_asked==3) {
								window.location.href = "/play_hard";
							}
							else {
								window.location.href = "/play";
							}
      					});
					}
					else{
						attempts += 1;
						skip(attempts); // check if the skip button should appear
						alert("Incorrect, please try again!");
						bool = true; // to restart the timer
						
						$.getJSON($SCRIPT_ROOT + '/_add_image_tried', { // calling the python function which will add the data to the db
        					input: img.word,
      					}, function(data) {
        					$("#result").text(data.result);
        					input.value= '';
      					});
					}
                }
            });
            
            function skip(attempts){ // if there has been three attempts, the skip button appear
				if(attempts < 3) {
					document.getElementById("skip").style.visibility="hidden";
				}
				if(attempts >= 3){
					document.getElementById("skip").style.visibility="visible";
				} 
			}    
            
            btn2.onclick= function() {
				var level = document.forms[0];
   				var level_asked = "";
    			var i;
    			for (i = 0; i < level.length; i++) {
        			if (level[i].checked) {
            			level_asked = level[i].value;
        			}
				}
				if (level_asked==1) {
					window.location.href = "/play_easy";
				}
				else if (level_asked==2) {
					window.location.href = "/play_medium";
				}
				else if (level_asked==3) {
					window.location.href = "/play_hard";
				}
				else {
					window.location.href = "/play";
				}
			}


		}
    </script>
    {% else %}
    <div> You know every word </div>
    {% endif %}
{% endblock %}